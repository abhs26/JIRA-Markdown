(function(){var b,e;if(typeof exports==="object"&&typeof require==="function"){b=exports;e=require("./Markdown.Converter").Converter}else{b=Markdown;e=b.Converter}b.getSanitizingConverter=function(k){var j=new e();j.hooks.chain("postConversion",function(l){return g(l,k)});j.hooks.chain("postConversion",a);return j};function g(j,k){return j.replace(/<[^>]*>?/gi,function(l){return f(l,k)})}var h=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul|table|thead|tbody|tr|td|th)>|<(br|hr)\s?\/?>)$/i;var d=/^(<a\shref="((https?|ftp):\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?(\sclass="[^"<>]+")?\s?>|<\/a>)$/i;var c=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?(\sclass="[^"<>]*")?\s?\/?>)$/i;var i=/^<(td|th)(\salign="(right|left|center)")?/i;function f(j,l){if(j.match(h)||j.match(d)||j.match(c)||j.match(i)){return j}else{if(l){var k='data-shared-secret="'+l+'"';if(j.indexOf(k)!=-1){return j.replace(k,"")}}return""}}function a(n){if(n==""){return""}var t=/<\/?\w+[^>]*(\s|$|>)/g;var u=n.toLowerCase().match(t);var s=(u||[]).length;if(s==0){return n}var r,v;var q="<p><img><br><li><hr>";var o;var p=[];var k=[];var m=false;for(var j=0;j<s;j++){r=u[j].replace(/<\/?(\w+).*/,"$1");if(p[j]||q.search("<"+r+">")>-1){continue}v=u[j];o=-1;if(!/^<\//.test(v)){for(var l=j+1;l<s;l++){if(!p[l]&&u[l]=="</"+r+">"){o=l;break}}}if(o==-1){m=k[j]=true}else{p[o]=true}}if(!m){return n}var j=0;n=n.replace(t,function(w){var x=k[j]?"":w;j++;return x});return n}})();