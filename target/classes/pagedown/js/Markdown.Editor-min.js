(function(){var a={},s={},l={},u=window.document,m=window.RegExp,g=window.navigator,o={lineLength:72},t={isIE:/msie/.test(g.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(g.userAgent.toLowerCase())||/msie 5/.test(g.userAgent.toLowerCase()),isOpera:/opera/.test(g.userAgent.toLowerCase())};var v='<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>';var p="<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \"optional title\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>";var c="http://";var d="http://";var j="Markdown Editing Help";Markdown.Editor=function(z,B,y){B=B||"";var w=this.hooks=new Markdown.HookCollection();w.addNoop("onPreviewRefresh");w.addNoop("postBlockquoteCreation");w.addFalse("insertImageDialog");this.getConverter=function(){return z};var A=this,x;this.run=function(){if(x){return}x=new i(B);var E=new k(w);var C=new h(z,x,function(){w.onPreviewRefresh()});var F,D;if(!/\?noundo/.test(u.location.href)){F=new e(function(){C.refresh();if(D){D.setUndoRedoButtonStates()}},x)}D=new q(B,x,F,C,E,y);D.setUndoRedoButtonStates();var G=A.refreshPreview=function(){C.refresh(true)};G()}};function r(){}r.prototype.findTags=function(x,z){var w=this;var y;if(x){y=a.extendRegExp(x,"","$");this.before=this.before.replace(y,function(A){w.startTag=w.startTag+A;return""});y=a.extendRegExp(x,"^","");this.selection=this.selection.replace(y,function(A){w.startTag=w.startTag+A;return""})}if(z){y=a.extendRegExp(z,"","$");this.selection=this.selection.replace(y,function(A){w.endTag=A+w.endTag;return""});y=a.extendRegExp(z,"^","");this.after=this.after.replace(y,function(A){w.endTag=A+w.endTag;return""})}};r.prototype.trimWhitespace=function(x){var w,z,y=this;if(x){w=z=""}else{w=function(A){y.before+=A;return""};z=function(A){y.after=A+y.after;return""}}this.selection=this.selection.replace(/^(\s*)/,w).replace(/(\s*)$/,z)};r.prototype.skipLines=function(y,x,w){if(y===undefined){y=1}if(x===undefined){x=1}y++;x++;var z;var A;if(navigator.userAgent.match(/Chrome/)){"X".match(/()./)}this.selection=this.selection.replace(/(^\n*)/,"");this.startTag=this.startTag+m.$1;this.selection=this.selection.replace(/(\n*$)/,"");this.endTag=this.endTag+m.$1;this.startTag=this.startTag.replace(/(^\n*)/,"");this.before=this.before+m.$1;this.endTag=this.endTag.replace(/(\n*$)/,"");this.after=this.after+m.$1;if(this.before){z=A="";while(y--){z+="\\n?";A+="\n"}if(w){z="\\n*"}this.before=this.before.replace(new m(z+"$",""),A)}if(this.after){z=A="";while(x--){z+="\\n?";A+="\n"}if(w){z="\\n*"}this.after=this.after.replace(new m(z,""),A)}};function i(w){this.buttonBar=u.getElementById("wmd-button-bar"+w);this.preview=u.getElementById("wmd-preview"+w);this.input=u.getElementById("wmd-input"+w)}a.isVisible=function(w){if(window.getComputedStyle){return window.getComputedStyle(w,null).getPropertyValue("display")!=="none"}else{if(w.currentStyle){return w.currentStyle.display!=="none"}}};a.addEvent=function(x,w,y){if(x.attachEvent){x.attachEvent("on"+w,y)}else{x.addEventListener(w,y,false)}};a.removeEvent=function(x,w,y){if(x.detachEvent){x.detachEvent("on"+w,y)}else{x.removeEventListener(w,y,false)}};a.fixEolChars=function(w){w=w.replace(/\r\n/g,"\n");w=w.replace(/\r/g,"\n");return w};a.extendRegExp=function(y,A,x){if(A===null||A===undefined){A=""}if(x===null||x===undefined){x=""}var z=y.toString();var w;z=z.replace(/\/([gim]*)$/,function(B,C){w=C;return""});z=z.replace(/(^\/|\/$)/g,"");z=A+z+x;return new m(z,w)};s.getTop=function(y,x){var w=y.offsetTop;if(!x){while(y=y.offsetParent){w+=y.offsetTop}}return w};s.getHeight=function(w){return w.offsetHeight||w.scrollHeight};s.getWidth=function(w){return w.offsetWidth||w.scrollWidth};s.getPageSize=function(){var x,y;var w,B;if(self.innerHeight&&self.scrollMaxY){x=u.body.scrollWidth;y=self.innerHeight+self.scrollMaxY}else{if(u.body.scrollHeight>u.body.offsetHeight){x=u.body.scrollWidth;y=u.body.scrollHeight}else{x=u.body.offsetWidth;y=u.body.offsetHeight}}if(self.innerHeight){w=self.innerWidth;B=self.innerHeight}else{if(u.documentElement&&u.documentElement.clientHeight){w=u.documentElement.clientWidth;B=u.documentElement.clientHeight}else{if(u.body){w=u.body.clientWidth;B=u.body.clientHeight}}}var A=Math.max(x,w);var z=Math.max(y,B);return[A,z,w,B]};function e(I,F){var L=this;var G=[];var D=0;var C="none";var x;var y;var B;var w=function(N,M){if(C!=N){C=N;if(!M){z()}}if(!t.isIE||C!="moving"){y=setTimeout(E,1)}else{B=null}};var E=function(M){B=new b(F,M);y=undefined};this.setCommandMode=function(){C="command";z();y=setTimeout(E,0)};this.canUndo=function(){return D>1};this.canRedo=function(){if(G[D+1]){return true}return false};this.undo=function(){if(L.canUndo()){if(x){x.restore();x=null}else{G[D]=new b(F);G[--D].restore();if(I){I()}}}C="none";F.input.focus();E()};this.redo=function(){if(L.canRedo()){G[++D].restore();if(I){I()}}C="none";F.input.focus();E()};var z=function(){var M=B||new b(F);if(!M){return false}if(C=="moving"){if(!x){x=M}return}if(x){if(G[D-1].text!=x.text){G[D++]=x}x=null}G[D++]=M;G[D+1]=null;if(I){I()}};var H=function(M){var O=false;if(M.ctrlKey||M.metaKey){var N=M.charCode||M.keyCode;var P=String.fromCharCode(N);switch(P){case"y":L.redo();O=true;break;case"z":if(!M.shiftKey){L.undo()}else{L.redo()}O=true;break}}if(O){if(M.preventDefault){M.preventDefault()}if(window.event){window.event.returnValue=false}return}};var K=function(M){if(!M.ctrlKey&&!M.metaKey){var N=M.keyCode;if((N>=33&&N<=40)||(N>=63232&&N<=63235)){w("moving")}else{if(N==8||N==46||N==127){w("deleting")}else{if(N==13){w("newlines")}else{if(N==27){w("escape")}else{if((N<16||N>20)&&N!=91){w("typing")}}}}}}};var A=function(){a.addEvent(F.input,"keypress",function(N){if((N.ctrlKey||N.metaKey)&&(N.keyCode==89||N.keyCode==90)){N.preventDefault()}});var M=function(){if(t.isIE||(B&&B.text!=F.input.value)){if(y==undefined){C="paste";z();E()}}};a.addEvent(F.input,"keydown",H);a.addEvent(F.input,"keydown",K);a.addEvent(F.input,"mousedown",function(){w("moving")});F.input.onpaste=M;F.input.ondrop=M};var J=function(){A();E(true);z()};J()}function b(x,z){var w=this;var y=x.input;this.init=function(){if(!a.isVisible(y)){return}if(!z&&u.activeElement&&u.activeElement!==y){return}this.setInputAreaSelectionStartEnd();this.scrollTop=y.scrollTop;if(!this.text&&y.selectionStart||y.selectionStart===0){this.text=y.value}};this.setInputAreaSelection=function(){if(!a.isVisible(y)){return}if(y.selectionStart!==undefined&&!t.isOpera){y.focus();y.selectionStart=w.start;y.selectionEnd=w.end;y.scrollTop=w.scrollTop}else{if(u.selection){if(u.activeElement&&u.activeElement!==y){return}y.focus();var A=y.createTextRange();A.moveStart("character",-y.value.length);A.moveEnd("character",-y.value.length);A.moveEnd("character",w.end);A.moveStart("character",w.start);A.select()}}};this.setInputAreaSelectionStartEnd=function(){if(!x.ieCachedRange&&(y.selectionStart||y.selectionStart===0)){w.start=y.selectionStart;w.end=y.selectionEnd}else{if(u.selection){w.text=a.fixEolChars(y.value);var D=x.ieCachedRange||u.selection.createRange();var E=a.fixEolChars(D.text);var C="\x07";var B=C+E+C;D.text=B;var F=a.fixEolChars(y.value);D.moveStart("character",-B.length);D.text=E;w.start=F.indexOf(C);w.end=F.lastIndexOf(C)-C.length;var A=w.text.length-a.fixEolChars(y.value).length;if(A){D.moveStart("character",-E.length);while(A--){E+="\n";w.end+=1}D.text=E}if(x.ieCachedRange){w.scrollTop=x.ieCachedScrollTop}x.ieCachedRange=null;this.setInputAreaSelection()}}};this.restore=function(){if(w.text!=undefined&&w.text!=y.value){y.value=w.text}this.setInputAreaSelection();y.scrollTop=w.scrollTop};this.getChunks=function(){var A=new r();A.before=a.fixEolChars(w.text.substring(0,w.start));A.startTag="";A.selection=a.fixEolChars(w.text.substring(w.start,w.end));A.endTag="";A.after=a.fixEolChars(w.text.substring(w.end));A.scrollTop=w.scrollTop;return A};this.setChunks=function(A){A.before=A.before+A.startTag;A.after=A.endTag+A.after;this.start=A.before.length;this.end=A.before.length+A.selection.length;this.text=A.before+A.selection+A.after;this.scrollTop=A.scrollTop};this.init()}function h(Q,z,K){var x=this;var E;var D;var N;var y=3000;var F="delayed";var B=function(S,T){a.addEvent(S,"input",T);S.onpaste=T;S.ondrop=T;a.addEvent(S,"keypress",T);a.addEvent(S,"keydown",T)};var J=function(){var S=0;if(window.innerHeight){S=window.pageYOffset}else{if(u.documentElement&&u.documentElement.scrollTop){S=u.documentElement.scrollTop}else{if(u.body){S=u.body.scrollTop}}}return S};var C=function(){if(!z.preview){return}var U=z.input.value;if(U&&U==N){return}else{N=U}var T=new Date().getTime();U=Q.makeHtml(U);var S=new Date().getTime();D=S-T;w(U)};var P=function(){if(E){clearTimeout(E);E=undefined}if(F!=="manual"){var S=0;if(F==="delayed"){S=D}if(S>y){S=y}E=setTimeout(C,S)}};var A=function(S){if(S.scrollHeight<=S.clientHeight){return 1}return S.scrollTop/(S.scrollHeight-S.clientHeight)};var R=function(){if(z.preview){z.preview.scrollTop=(z.preview.scrollHeight-z.preview.clientHeight)*A(z.preview)}};this.refresh=function(S){if(S){N="";C()}else{P()}};this.processingTime=function(){return D};var G=true;var H=function(V){var U=z.preview;var T=U.parentNode;var S=U.nextSibling;T.removeChild(U);U.innerHTML=V;if(!S){T.appendChild(U)}else{T.insertBefore(U,S)}};var M=function(S){z.preview.innerHTML=S};var I;var L=function(T){if(I){return I(T)}try{M(T);I=M}catch(S){I=H;I(T)}};var w=function(U){var S=s.getTop(z.input)-J();if(z.preview){L(U);K()}R();if(G){G=false;return}var T=s.getTop(z.input)-J();if(t.isIE){setTimeout(function(){window.scrollBy(0,T-S)},0)}else{window.scrollBy(0,T-S)}};var O=function(){B(z.input,P);C();if(z.preview){z.preview.scrollTop=0}};O()}l.createBackground=function(){var x=u.createElement("div"),y=x.style;x.className="wmd-prompt-background";y.position="absolute";y.top="0";y.zIndex="1000";if(t.isIE){y.filter="alpha(opacity=50)"}else{y.opacity="0.5"}var w=s.getPageSize();y.height=w[1]+"px";if(t.isIE){y.left=u.documentElement.scrollLeft;y.width=u.documentElement.clientWidth}else{y.left="0";y.width="100%"}u.body.appendChild(x);return x};l.prompt=function(B,z,D){var y;var x;if(z===undefined){z=""}var C=function(E){var F=(E.charCode||E.keyCode);if(F===27){A(true)}};var A=function(E){a.removeEvent(u.body,"keydown",C);var F=x.value;if(E){F=null}else{F=F.replace(/^http:\/\/(https?|ftp):\/\//,"$1://");if(!/^(?:https?|ftp):\/\//.test(F)){F="http://"+F}}y.parentNode.removeChild(y);D(F);return false};var w=function(){y=u.createElement("div");y.className="wmd-prompt-dialog";y.style.padding="10px;";y.style.position="fixed";y.style.width="400px";y.style.zIndex="9001";var E=u.createElement("div");E.innerHTML=B;E.style.padding="5px";y.appendChild(E);var G=u.createElement("form"),F=G.style;G.onsubmit=function(){return A(false)};F.padding="0";F.margin="0";F.cssFloat="left";F.width="100%";F.textAlign="center";F.position="relative";y.appendChild(G);x=u.createElement("input");x.type="text";x.value=z;F=x.style;F.display="block";F.width="80%";F.marginLeft=F.marginRight="auto";G.appendChild(x);var I=u.createElement("input");I.type="button";I.onclick=function(){return A(false)};I.value="OK";F=I.style;F.margin="10px";F.display="inline";F.width="7em";var H=u.createElement("input");H.type="button";H.onclick=function(){return A(true)};H.value="Cancel";F=H.style;F.margin="10px";F.display="inline";F.width="7em";G.appendChild(I);G.appendChild(H);a.addEvent(u.body,"keydown",C);y.style.top="50%";y.style.left="50%";y.style.display="block";if(t.isIE_5or6){y.style.position="absolute";y.style.top=u.documentElement.scrollTop+200+"px";y.style.left="50%"}u.body.appendChild(y);y.style.marginTop=-(s.getHeight(y)/2)+"px";y.style.marginLeft=-(s.getWidth(y)/2)+"px"};setTimeout(function(){w();var F=z.length;if(x.selectionStart!==undefined){x.selectionStart=0;x.selectionEnd=F}else{if(x.createTextRange){var E=x.createTextRange();E.collapse(false);E.moveStart("character",-F);E.moveEnd("character",F);E.select()}}x.focus()},0)};function q(H,C,J,y,G,B){var A=C.input,E={};z();var D="keydown";if(t.isOpera){D="keypress"}a.addEvent(A,D,function(L){if((L.ctrlKey||L.metaKey)&&!L.altKey&&!L.shiftKey){var M=L.charCode||L.keyCode;var K=String.fromCharCode(M).toLowerCase();switch(K){case"b":I(E.bold);break;case"i":I(E.italic);break;case"l":I(E.link);break;case"q":I(E.quote);break;case"k":I(E.code);break;case"g":I(E.image);break;case"o":I(E.olist);break;case"u":I(E.ulist);break;case"h":I(E.heading);break;case"r":I(E.hr);break;case"y":I(E.redo);break;case"z":if(L.shiftKey){I(E.redo)}else{I(E.undo)}break;default:return}if(L.preventDefault){L.preventDefault()}if(window.event){window.event.returnValue=false}}});a.addEvent(A,"keyup",function(L){if(L.shiftKey&&!L.ctrlKey&&!L.metaKey){var M=L.charCode||L.keyCode;if(M===13){var K={};K.textOp=x("doAutoindent");I(K)}}});if(t.isIE){a.addEvent(A,"keydown",function(K){var L=K.keyCode;if(L===27){return false}})}function I(L){A.focus();if(L.textOp){if(J){J.setCommandMode()}var N=new b(C);if(!N){return}var O=N.getChunks();var K=function(){A.focus();if(O){N.setChunks(O)}N.restore();y.refresh()};var M=L.textOp(O,K);if(!M){K()}}if(L.execute){L.execute(J)}}function w(K,M){var N="0px";var P="-20px";var L="-40px";var O=K.getElementsByTagName("span")[0];if(M){O.style.backgroundPosition=K.XShift+" "+N;K.onmouseover=function(){O.style.backgroundPosition=this.XShift+" "+L};K.onmouseout=function(){O.style.backgroundPosition=this.XShift+" "+N};if(t.isIE){K.onmousedown=function(){if(u.activeElement&&u.activeElement!==C.input){return}C.ieCachedRange=document.selection.createRange();C.ieCachedScrollTop=C.input.scrollTop}}if(!K.isHelp){K.onclick=function(){if(this.onmouseout){this.onmouseout()}I(this);return false}}}else{O.style.backgroundPosition=K.XShift+" "+P;K.onmouseover=K.onmouseout=K.onclick=function(){}}}function x(K){if(typeof K==="string"){K=G[K]}return function(){K.apply(G,arguments)}}function z(){var O=C.buttonBar;var S="0px";var N="-20px";var Q="-40px";var R=document.createElement("ul");R.id="wmd-button-row"+H;R.className="wmd-button-row";R=O.appendChild(R);var K=0;var T=function(aa,Y,X,Z){var W=document.createElement("li");W.className="wmd-button";W.style.left=K+"px";K+=25;var V=document.createElement("span");W.id=aa+H;W.appendChild(V);W.title=Y;W.XShift=X;if(Z){W.textOp=Z}w(W,true);R.appendChild(W);return W};var M=function(W){var V=document.createElement("li");V.className="wmd-spacer wmd-spacer"+W;V.id="wmd-spacer"+W+H;R.appendChild(V);K+=25};E.bold=T("wmd-bold-button","Strong <strong> Ctrl+B","0px",x("doBold"));E.italic=T("wmd-italic-button","Emphasis <em> Ctrl+I","-20px",x("doItalic"));M(1);E.link=T("wmd-link-button","Hyperlink <a> Ctrl+L","-40px",x(function(V,W){return this.doLinkOrImage(V,W,false)}));E.quote=T("wmd-quote-button","Blockquote <blockquote> Ctrl+Q","-60px",x("doBlockquote"));E.code=T("wmd-code-button","Code Sample <pre><code> Ctrl+K","-80px",x("doCode"));E.image=T("wmd-image-button","Image <img> Ctrl+G","-100px",x(function(V,W){return this.doLinkOrImage(V,W,true)}));M(2);E.olist=T("wmd-olist-button","Numbered List <ol> Ctrl+O","-120px",x(function(V,W){this.doList(V,W,true)}));E.ulist=T("wmd-ulist-button","Bulleted List <ul> Ctrl+U","-140px",x(function(V,W){this.doList(V,W,false)}));E.heading=T("wmd-heading-button","Heading <h1>/<h2> Ctrl+H","-160px",x("doHeading"));E.hr=T("wmd-hr-button","Horizontal Rule <hr> Ctrl+R","-180px",x("doHorizontalRule"));M(3);E.undo=T("wmd-undo-button","Undo - Ctrl+Z","-200px",null);E.undo.execute=function(V){if(V){V.undo()}};var U=/win/.test(g.platform.toLowerCase())?"Redo - Ctrl+Y":"Redo - Ctrl+Shift+Z";E.redo=T("wmd-redo-button",U,"-220px",null);E.redo.execute=function(V){if(V){V.redo()}};if(B){var P=document.createElement("li");var L=document.createElement("span");P.appendChild(L);P.className="wmd-button wmd-help-button";P.id="wmd-help-button"+H;P.XShift="-240px";P.isHelp=true;P.style.right="0px";P.title=B.title||j;P.onclick=B.handler;w(P,true);R.appendChild(P);E.help=P}F()}function F(){if(J){w(E.undo,J.canUndo());w(E.redo,J.canRedo())}}this.setUndoRedoButtonStates=F}function k(w){this.hooks=w}var f=k.prototype;f.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)";f.unwrap=function(x){var w=new m("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");x.selection=x.selection.replace(w,"$1 $2")};f.wrap=function(x,w){this.unwrap(x);var z=new m("(.{1,"+w+"})( +|$\\n?)","gm"),y=this;x.selection=x.selection.replace(z,function(A,B){if(new m("^"+y.prefixes,"").test(A)){return A}return B+"\n"});x.selection=x.selection.replace(/\s+$/,"")};f.doBold=function(w,x){return this.doBorI(w,x,2,"strong text")};f.doItalic=function(w,x){return this.doBorI(w,x,1,"emphasized text")};f.doBorI=function(C,A,B,w){C.trimWhitespace();C.selection=C.selection.replace(/\n{2,}/g,"\n");var z=/(\**$)/.exec(C.before)[0];var x=/(^\**)/.exec(C.after)[0];var D=Math.min(z.length,x.length);if((D>=B)&&(D!=2||B!=1)){C.before=C.before.replace(m("[*]{"+B+"}$",""),"");C.after=C.after.replace(m("^[*]{"+B+"}",""),"")}else{if(!C.selection&&x){C.after=C.after.replace(/^([*_]*)/,"");C.before=C.before.replace(/(\s?)$/,"");var y=m.$1;C.before=C.before+x+y}else{if(!C.selection&&!x){C.selection=w}var E=B<=1?"*":"**";C.before=C.before+E;C.after=E+C.after}}return};f.stripLinkDefs=function(x,w){x=x.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(B,C,y,z,A){w[C]=B.replace(/\s*$/,"");if(z){w[C]=B.replace(/["(](.+?)[")]$/,"");return z+A}return""});return x};f.addLinkDef=function(D,z){var w=0;var y={};D.before=this.stripLinkDefs(D.before,y);D.selection=this.stripLinkDefs(D.selection,y);D.after=this.stripLinkDefs(D.after,y);var x="";var C=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g;var B=function(F){w++;F=F.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+w+"]:");x+="\n"+F};var A=function(G,J,H,I,K,F){H=H.replace(C,A);if(y[K]){B(y[K]);return J+H+I+w+F}return G};D.before=D.before.replace(C,A);if(z){B(z)}else{D.selection=D.selection.replace(C,A)}var E=w;D.after=D.after.replace(C,A);if(D.after){D.after=D.after.replace(/\n*$/,"")}if(!D.after){D.selection=D.selection.replace(/\n*$/,"")}D.after+="\n\n"+x;return E};function n(w){return w.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(y,x,z){x=x.replace(/\?.*$/,function(A){return A.replace(/\+/g," ")});x=decodeURIComponent(x);x=encodeURI(x).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29");x=x.replace(/\?.*$/,function(A){return A.replace(/\+/g,"%2b")});if(z){z=z.trim?z.trim():z.replace(/^\s*/,"").replace(/\s*$/,"");z=$.trim(z).replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return z?x+' "'+z+'"':x})}f.doLinkOrImage=function(w,y,B){w.trimWhitespace();w.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);var x;if(w.endTag.length>1&&w.startTag.length>0){w.startTag=w.startTag.replace(/!?\[/,"");w.endTag="";this.addLinkDef(w,null)}else{w.selection=w.startTag+w.selection+w.endTag;w.startTag=w.endTag="";if(/\n\n/.test(w.selection)){this.addLinkDef(w,null);return}var z=this;var A=function(E){x.parentNode.removeChild(x);if(E!==null){w.selection=(" "+w.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var D=" [999]: "+n(E);var C=z.addLinkDef(w,D);w.startTag=B?"![":"[";w.endTag="]["+C+"]";if(!w.selection){if(B){w.selection="enter image description here"}else{w.selection="enter link description here"}}}y()};x=l.createBackground();if(B){if(!this.hooks.insertImageDialog(A)){l.prompt(p,c,A)}}else{l.prompt(v,d,A)}return true}};f.doAutoindent=function(x,y){var w=this;x.before=x.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n");x.before=x.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n");x.before=x.before.replace(/(\n|^)[ \t]+\n$/,"\n\n");if(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(x.before)){if(w.doList){w.doList(x)}}if(/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(x.before)){if(w.doBlockquote){w.doBlockquote(x)}}if(/(\n|^)(\t|[ ]{4,}).*\n$/.test(x.before)){if(w.doCode){w.doCode(x)}}};f.doBlockquote=function(D,y){D.selection=D.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(J,I,H,G){D.before+=I;D.after=G+D.after;return H});D.before=D.before.replace(/(>[ \t]*)$/,function(H,G){D.selection=G+D.selection;return""});D.selection=D.selection.replace(/^(\s|>)+$/,"");D.selection=D.selection||"Blockquote";var C="",B="",E;if(D.before){var F=D.before.replace(/\n$/,"").split("\n");var A=false;for(var z=0;z<F.length;z++){var x=false;E=F[z];A=A&&E.length>0;if(/^>/.test(E)){x=true;if(!A&&E.length>1){A=true}}else{if(/^[ \t]*$/.test(E)){x=true}else{x=A}}if(x){C+=E+"\n"}else{B+=C+E;C="\n"}}if(!/(^|\n)>/.test(C)){B+=C;C=""}}D.startTag=C;D.before=B;if(D.after){D.after=D.after.replace(/^\n?/,"\n")}D.after=D.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(G){D.endTag=G;return""});var w=function(H){var G=H?"> ":"";if(D.startTag){D.startTag=D.startTag.replace(/\n((>|\s)*)\n$/,function(J,I){return"\n"+I.replace(/^[ ]{0,3}>?[ \t]*$/gm,G)+"\n"})}if(D.endTag){D.endTag=D.endTag.replace(/^\n((>|\s)*)\n/,function(J,I){return"\n"+I.replace(/^[ ]{0,3}>?[ \t]*$/gm,G)+"\n"})}};if(/^(?![ ]{0,3}>)/m.test(D.selection)){this.wrap(D,o.lineLength-2);D.selection=D.selection.replace(/^/gm,"> ");w(true);D.skipLines()}else{D.selection=D.selection.replace(/^[ ]{0,3}> ?/gm,"");this.unwrap(D);w(false);if(!/^(\n|^)[ ]{0,3}>/.test(D.selection)&&D.startTag){D.startTag=D.startTag.replace(/\n{0,2}$/,"\n\n")}if(!/(\n|^)[ ]{0,3}>.*$/.test(D.selection)&&D.endTag){D.endTag=D.endTag.replace(/^\n{0,2}/,"\n\n")}}D.selection=this.hooks.postBlockquoteCreation(D.selection);if(!/\n/.test(D.selection)){D.selection=D.selection.replace(/^(> *)/,function(G,H){D.startTag+=H;return""})}};f.doCode=function(w,x){var z=/\S[ ]*$/.test(w.before);var B=/^[ ]*\S/.test(w.after);if((!B&&!z)||/\n/.test(w.selection)){w.before=w.before.replace(/[ ]{4}$/,function(C){w.selection=C+w.selection;return""});var A=1;var y=1;if(/\n(\t|[ ]{4,}).*\n$/.test(w.before)){A=0}if(/^\n(\t|[ ]{4,})/.test(w.after)){y=0}w.skipLines(A,y);if(!w.selection){w.startTag="    ";w.selection="enter code here"}else{if(/^[ ]{0,3}\S/m.test(w.selection)){w.selection=w.selection.replace(/^/gm,"    ")}else{w.selection=w.selection.replace(/^[ ]{4}/gm,"")}}}else{w.trimWhitespace();w.findTags(/`/,/`/);if(!w.startTag&&!w.endTag){w.startTag=w.endTag="`";if(!w.selection){w.selection="enter code here"}}else{if(w.endTag&&!w.startTag){w.before+=w.endTag;w.endTag=""}else{w.startTag=w.endTag=""}}}};f.doList=function(H,A,z){var J=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/;var I=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/;var w="-";var E=1;var C=function(){var K;if(z){K=" "+E+". ";E++}else{K=" "+w+" "}return K};var D=function(K){if(z===undefined){z=/^\s*\d/.test(K)}K=K.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(L){return C()});return K};H.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null);if(H.before&&!/\n$/.test(H.before)&&!/^\n/.test(H.startTag)){H.before+=H.startTag;H.startTag=""}if(H.startTag){var y=/\d+[.]/.test(H.startTag);H.startTag="";H.selection=H.selection.replace(/\n[ ]{4}/g,"\n");this.unwrap(H);H.skipLines();if(y){H.after=H.after.replace(I,D)}if(z==y){return}}var B=1;H.before=H.before.replace(J,function(K){if(/^\s*([*+-])/.test(K)){w=m.$1}B=/[^\n]\n\n[^\n]/.test(K)?1:0;return D(K)});if(!H.selection){H.selection="List item"}var F=C();var x=1;H.after=H.after.replace(I,function(K){x=/[^\n]\n\n[^\n]/.test(K)?1:0;return D(K)});H.trimWhitespace(true);H.skipLines(B,x,true);H.startTag=F;var G=F.replace(/./g," ");this.wrap(H,o.lineLength-G.length);H.selection=H.selection.replace(/\n/g,"\n"+G)};f.doHeading=function(y,z){y.selection=y.selection.replace(/\s+/g," ");y.selection=y.selection.replace(/(^\s+|\s+$)/g,"");if(!y.selection){y.startTag="## ";y.selection="Heading";y.endTag=" ##";return}var A=0;y.findTags(/#+[ ]*/,/[ ]*#+/);if(/#+/.test(y.startTag)){A=m.lastMatch.length}y.startTag=y.endTag="";y.findTags(null,/\s?(-+|=+)/);if(/=+/.test(y.endTag)){A=1}if(/-+/.test(y.endTag)){A=2}y.startTag=y.endTag="";y.skipLines(1,1);var B=A==0?2:A-1;if(B>0){var x=B>=2?"-":"=";var w=y.selection.length;if(w>o.lineLength){w=o.lineLength}y.endTag="\n";while(w--){y.endTag+=x}}};f.doHorizontalRule=function(w,x){w.startTag="----------\n";w.selection="";w.skipLines(2,1,true)}})();